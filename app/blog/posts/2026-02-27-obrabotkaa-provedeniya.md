---
title: "обработкаа проведения "
description: "обработкаа проведения "
date: 2026-02-05
tag:
  - СКД
---
```
Процедура ОбработкаПроведения(Отказ, Режим)
	Движения.ОсновныеНачисления.Записывать = Истина; 
	
	// заполнение регистра 
	Для Каждого ТекСтрокаОсновныеНачисления Из ОсновныеНачисления Цикл
		Движение = Движения.ОсновныеНачисления.Добавить();
		Движение.Сторно = Ложь;
		Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;
		Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ДатаНачала;
		Движение.ПериодДействияКонец = КонецДня(ТекСтрокаОсновныеНачисления.ДатаОкончания);
		Движение.ПериодРегистрации = Дата;
		Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;
		Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;
		Движение.График = ТекСтрокаОсновныеНачисления.График;
		Если ТекСтрокаОсновныеНачисления.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда
			Движение.Результат = ТекСтрокаОсновныеНачисления.Размер;
		КонецЕсли;
		// эти данные заполняются ниже
		//Движение.Факт = ??;
		//Движение.Размер =??; 	
	КонецЦикла; 
	Движения.Записать();

	// расчет
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ОсновныеНачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки,
		|	ОсновныеНачисленияДанныеГрафика.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисленияДанныеГрафика.Подразделение КАК Подразделение,
		|	ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЗначениеЧасыПериодДействия, 0) КАК Норма,
		|	ЕСТЬNULL(ОсновныеНачисленияДанныеГрафика.ЗначениеЧасыФактическийПериодДействия, 0) КАК Отработано,
		|	СтавкаЗаТелефон.Значение КАК Ставка
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисления.ДанныеГрафика(
		|			Регистратор = &Ссылка
		|				) КАК ОсновныеНачисленияДанныеГрафика,
		|	Константа.СтавкаЗаТелефон КАК СтавкаЗаТелефон";
	
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Для Каждого СтрокаНабора Из Движения.ОсновныеНачисления Цикл
		
		Выборка.Сбросить();
		Выборка.НайтиСледующий(СтрокаНабора.НомерСтроки, "НомерСтроки");
		
		Если СтрокаНабора.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда
			СтрокаНабора.Факт = Выборка.Отработано;
		ИначеЕсли СтрокаНабора.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Телефон Тогда 
			СтрокаНабора.Факт = Выборка.Отработано;
			СтрокаНабора.Результат = Выборка.Ставка * Выборка.Отработано;
		КонецЕсли;
	КонецЦикла;
	Движения.ОсновныеНачисления.Записать(, Истина);	

КонецПроцедуры
```